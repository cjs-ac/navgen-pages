<!DOCTYPE html>
<html>
  <head>
    <title>navgen</title>
    <style>
      :root {
        --base03    :#002b36;
        --base02    :#073642;
        --base01    :#586e75;
        --base00    :#657b83;
        --base0     :#839496;
        --base1     :#93a1a1;
        --base2     :#eee8d5;
        --base3     :#fdf6e3;
        --yellow    :#b58900;
        --orange    :#cb4b16;
        --red       :#dc322f;
        --magenta   :#d33682;
        --violet    :#6c71c4;
        --blue      :#268bd2;
        --cyan      :#2aa198;
        --green     :#859900;
      }
      body {
        font-family: sans-serif;
        color: var(--base00);
        background-color: var(--base3);
      }
      label {
        display: block;
      }
      :invalid {
        background-color: var(--red);
      }
    </style>
    <script>
      function getBearingNaturalRadians(point1, point2) {
        var x1, y1, x2, y2;
        x1 = parseInt(point1.substr(0, 5), 10);
        y1 = parseInt(point1.substr(4, 5), 10);
        x2 = parseInt(point2.substr(0, 5), 10);
        y2 = parseInt(point2.substr(4, 5), 10);
        return Math.atan2(y2 - y1, x2 - x1);
      }
      function getDistance(point1, point2) {
        var x1, y1, x2, y2;
        x1 = parseInt(point1.substr(0, 5), 10);
        y1 = parseInt(point1.substr(4, 5), 10);
        x2 = parseInt(point2.substr(0, 5), 10);
        y2 = parseInt(point2.substr(4, 5), 10);
        return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
      }
      function getBearingInDegrees(bearing) {
        return -(bearing * 360 / Math.PI) + 90;
      }
      function getBearingInMils(bearing) {
        return -(bearing * 6400 / Math.PI) + 1600;
      }
      function addPoint() {
        numberOfPoints++;
        var newLabel = document.createElement("label");
        var newInput = document.createElement("input");
        newLabel.setAttribute("for", "inputPoint" + numberOfPoints);
        newLabel.setAttribute("id", "inputPoint" + numberOfPoints + "Label");
        newLabel.setAttribute("class", "PointLabel");
        newLabel.appendChild(document.createTextNode("Point " + numberOfPoints));
        newInput.setAttribute("type", "text");
        newInput.setAttribute("id", "inputPoint" + numberOfPoints);
        newInput.setAttribute("class", "PointInput");
        newInput.setAttribute("pattern", "[0-9]{10}");
        document.getElementById("divPoints").appendChild(newLabel);
        document.getElementById("divPoints").appendChild(newInput);
      }
      function removePoint() {
        if (numberOfPoints > 2) {
          var Label = document.getElementById("inputPoint" + numberOfPoints + "Label");
          var Input = document.getElementById("inputPoint" + numberOfPoints);
          Label.parentNode.removeChild(Label);
          Input.parentNode.removeChild(Input);
          numberOfPoints--;
        }
      }
      function Calculate() {
        var TableBody = document.getElementById("TableBody");
        while (TableBody.firstChild) {
          TableBody.removeChild(TableBody.firstChild);
        }
        var i;
        for (i = 1; i < numberOfPoints; i++) {
          var Bearing, Distance;
          Bearing = getBearingNaturalRadians(document.getElementById("inputPoint" + i).value, document.getElementById("inputPoint" + (i + 1)).value);
          Distance = getDistance(document.getElementById("inputPoint" + i).value, document.getElementById("inputPoint" + (i + 1)).value);
          if (document.getElementById("useMils").checked == true) {
            Bearing = getBearingInMils(Bearing);
            while (Bearing < 0) {
              Bearing += 6400;
            }
          } else {
            Bearing = getBearingInDegrees(Bearing);
            while (Bearing < 0) {
              Bearing += 360;
            }
          }
          Bearing = Math.round(Bearing);
          Distance = Math.round(Distance);
          var OutRow = document.createElement("tr");
          var OutLeg = document.createElement("td");
          OutLeg.appendChild(document.createTextNode(i));
          OutRow.appendChild(OutLeg);
          var OutFrom = document.createElement("td");
          OutFrom.appendChild(document.createTextNode(document.getElementById("inputPoint" + i).value));
          OutRow.appendChild(OutFrom);
          var OutTo = document.createElement("td");
          OutTo.appendChild(document.createTextNode(document.getElementById("inputPoint" + (i + 1)).value));
          OutRow.appendChild(OutTo);
          var OutGrid = document.createElement("td");
          OutGrid.appendChild(document.createTextNode(Bearing));
          OutRow.appendChild(OutGrid);
          var OutMag = document.createElement("td");
          OutMag.appendChild(document.createTextNode(Bearing - document.getElementById("magDeviation").value));
          OutRow.appendChild(OutMag);
          var OutDistance = document.createElement("td");
          OutDistance.appendChild(document.createTextNode(Distance));
          OutRow.appendChild(OutDistance);
          TableBody.appendChild(OutRow);
        }
      }
    </script>
  </head>
  <body>
    <h1>navgen</h1>
    <label for="useMils">
      <input type="checkbox" id="useMils" />
      Use Mils instead of Degrees
    </label>
    <label for="magDeviation">Magnetic Deviation (degrees or mils)</label>
    <input type="number" id="magDeviation" />
    <div>
      <button onclick="addPoint()">Add Point</button>
      <button onclick="removePoint()">Remove Point</button>
    </div>
    <div id="divPoints">
      <label for="inputPoint1" id="inputPoint1Label" class="PointLabel">Point 1</label>
      <input type="text" id="inputPoint1" class="PointInput" pattern="[0-9]{10}" />
      <label for="inputPoint2" id="inputPoint2Label" class="PointLabel">Point 2</label>
      <input type="text" id="inputPoint2" class="PointInput" pattern="[0-9]{10}" />
    </div>
    <button onclick="Calculate()">Calculate</button>
    <table>
      <thead>
        <tr>
          <th>Leg</th>
          <th>From</th>
          <th>To</th>
          <th>Grid Bearing</th>
          <th>Magnetic Bearing</th>
          <th>Distance</th>
        </tr>
      </thead>
      <tbody id="TableBody" />
    </table>
  </body>
  <script>
    var numberOfPoints = 2;
    document.getElementById('magDeviation').value = 13;
  </script>
</html>
